# 1. Helmholtz coil simulator

This project aim is to prototype some kind of system control it automaticaly and make some fields setups in static applications.

## Table of contents

  - [1. Helmholtz coil simulator](#1-helmholtz-coil-simulator)
  - [2. Base Knowledge](#2-base-knowledge)
  - [3. Helmholtz coils design](#3-helmholtz-coils-design)
    - [3.1. Simulator](#31-simulator)
        - [3.1.1. Input parameters:](#311-input-parameters)
        - [3.1.2. Console results](#312-console-results)
        - [3.1.3. Graphical Results](#313-graphical-results)
        - [3.1.4. Simulator results](#314-simulator-results)
      - [3.2. D models](#32-d-models)
        - [3.2.1. axis helmholtz coil 3D model](#321-axis-helmholtz-coil-3d-model)
      - [3.3. Coils winding](#33-coils-winding)
- [4. System applications](#4-system-applications)

# 2. Base Knowledge

To create a homogeneous field in some free space region, the concept used was the [Helmholtz coil] that can create a homogeneous field inward from the coils to the geometric center of the estructure, the more in the center, the more homogeneous the field is.

Exciting the coils with a known current generates a known [magnetic field] (H) that is related to the magnetic flux density (B) by the permeability ($\mu$) of the material, in this case the air ([1.00000037])

The B can [saturate] depending on the material, in this case it will not happen so there are no linearity problems

Knowing that the magnetic field will be linear, so a 3 axis Helmholtz coil can be design to generate the arbitrary homogeneous magnetic field, remembering that this system must compensate the [earth magnetic field]

# 3. Helmholtz coils design

## 3.1. Simulator

To design the needed helmholtz coils, an open source python library was used, [magpylib], this library is capable to calculate magnetic field, through analytical solutions, of permanent magnets and current lines or current loops.

In fact the application is static, so the helmholtz can projected as current loops placed in a helmholtz coil shape.

<p align="center">
  <img src="https://i.imgur.com/Wa3sqmD.png">
</p>

 From the cross-cut section the parameters for the coils calculation can be extracted as the following figure:

<p align="center">
  <img src="https://i.imgur.com/ME0H3qo.png">
</p>

The details about the calculator can be seen in the [Helmholtz coil calculator] and [Auxiliar library] files. Giving some parameters to the calculator, it gives us the necessary coil diameter to achieve the desired field in the center of the coil and graphics that shows the field strenght in the 3 vectors of the field separeted (x,y,z) and from this an analysis can be made to determine the homogenity of the field generated by each coil, amplitude and angle error relative to the center in the desired homogeneous region. Following the input and the results in this project.

###  3.1.1. Input parameters:

Those are the input parameters for the calculator to find the diameter necessary the design each coil, following previous figure standards.

``` python
# have to use a little bit bigger value than wireExternalDiameter, if not, the wire will not fit inside
AllCoilsWireDiameter = (0.56 + 0.047)*1.09   # Wire diameter in mm (from dataSheet)

minRes = 0.06736                            # Ohms/m (from dataSheet)
nominal = 0.06940                           # Ohms/m (from dataSheet)
maxRes = 0.07153                            # Ohms/m (from dataSheet)

wireResistence = maxRes                     # Ohms/m (from dataSheet)


# z First Coil configuration

zInitialValueCoilDiameter = 80 # Initial value for the function that calculates the precise diameter


zCoilCurrent = 0.5             # Amperes
zLoopsInEachEvenLayer = 10     # The number of loops in each layer
zEvenLayers = 7                # The evenlayers always have to be equal to oddLayers or oddLayers + 1
zOddLayers = 7
zDesiredField = 1.25           # The desired field in the center of the Helmholtz coil

# y Second Coil configuration

yCoilCurrent = 0.5             # Amperes
yLoopsInEachEvenLayer = 6      # The number of loops in each layer
yEvenLayers = 3                # The evenlayers always have to be oddLayers + 1 or equal oddLayers
yOddLayers = 3
yDesiredField = 0.25           # The desired field in the center of the Helmholtz coil

# x Third Coil configuration

xCoilCurrent = 0.5             # Amperes
xLoopsInEachEvenLayer = 7      # The number of loops in each layer
xEvenLayers = 3                # The evenlayers always have to be oddLayers + 1 or equal oddLayers
xOddLayers = 3
xDesiredField = 0.25           # The desired field in the center of the Helmholtz coil
```
[main_script](./HelmholtzCoilCalculator.py)

[utils_lib](./magpylibUtils.py)

###  3.1.2. Console results

Those are the results that shows up in the standard output, in this case the console of spyder, those results can estimate how much wire in meters and the power in watts that will be dissipated on each helmholtz coil individualy.

![](https://i.imgur.com/5LN3UF7.png)

###  3.1.3. Graphical Results

Those are the graphical results of the calculator. For each coil a graphic is generated with the amplitude of the magnetic field of a slice in the center of the coil, this slice must have the region of interest, it also displays a 3D graphic of what the system looks like. Those graphics can help to estimate the homogenity level of the whole region.

<p align="center">
  <img src="https://i.imgur.com/wLzB2G6.png">
  <img src="https://i.imgur.com/yHOCoEb.png">
</p>

<p align="center">
  <img src="https://i.imgur.com/GD7dLiL.png">
  <img src="https://i.imgur.com/YyC5epl.png">
</p>

<p align="center">
  <img src="https://i.imgur.com/DbHoJWf.png">
  <img src="https://i.imgur.com/ByeGGDB.png">
</p>

As can be seen in the next figures, the calculator estimates the interference of the cables used to bring the current to the coils, the current passing throught them generates a field and it can be compared with the field generated for each coil. Just the field of the connectors is showed in the graphics. Another that can be seen is if the coils will be inside each other in the 3D representation, it's shown in the 3 coils figure that the coils don't touch each other in this case.

<p align="center">
  <img src="https://i.imgur.com/bi9lrz0.png">
  <img src="https://i.imgur.com/nGmvyGo.png">
</p>

<p align="center">
  <img src="https://i.imgur.com/zuLQytt.png">
  <img src="https://i.imgur.com/QZL5wMg.png">
  <img src="https://i.imgur.com/Mi18fzv.png">
</p>

###  3.1.4. Simulator results

After checking all the homogenity and interference stuff, the interested parameters to construct the coils support are shown in the next table:

Wire External Diameter = 0.6 mm

|Coils| Radius | Coil Width| Coil Height|
|:-:|-|-|-|
| Inner | 42.5 mm | 6.6 mm | 9.65 mm |
| Middle | 56.15 mm | 4 mm | 5.5 mm |
| External | 66.5 mm | 4.65 mm | 5.5 mm |
**\* rouded values**

##  3.2. 3D model

With the high precision of the 3D printers ($\pm$ 1 $\mu$m) the idea was doing the 3 helmholtz coils all together in the same mechanical part, 1 piece. With this, the misalignment problems would desappear.

Misalignment example:
<p align="center">
  <img src="https://i.imgur.com/UBLSEGI.png">
</p>

To design the 3D model the utilized software was [solidWorks], a comercial software for 3D models design, good for geometric models. The design was made based in the simulating results. Besides the coils, the sensor and sample placement should be designed together with the coil, to make it easier to think the supports was separated and connected throught holes and pegs.

###  3.2.1. axis helmholtz coil 3D model

The 3 axis helmholtz coil 3D model design can be seen in the following images:

<p align="center">
  <img src="https://i.imgur.com/1w3yt66.png">
  <img src="https://i.imgur.com/ZZijRJx.png">
  <img src="https://i.imgur.com/SFO0BPS.png">
</p>

It has some holes inside to attach the sensor support and a bigger hole in the middle for the cables to link the sensor to the system. In the bottom some support points to make the coil stable in the table.


##  3.3. Coils winding

After doing the windings really carefull, maintaining the [wire] stretched while doing each turn, it helped to get the wire really fit in the coils support. The arrangement to stretch the wire can be seen in the next image, its an improvised tool that makes some pressure in the reel, extremely important to make the coils the most near to the simulation position of the wires.

<p align="center">
  <img src="https://i.imgur.com/IUi05BB.png">
  <img src="https://i.imgur.com/KXlm8cY.png">
</p>

 The [hot glue] was used to mantain the cables fixed in the coils suppor, the result of the 3 axis coil can be seen in the following image:

<p align="center">
  <img src="https://i.imgur.com/l0JHXrs.png">
  <img src="https://i.imgur.com/IkDBRM8.png">
</p>

Each of the six coils was done individualy, doing the inside coils first, and then connected with a solder point with the respective pair (2 coils in X direction to form the X helmholtz coil for example)

#  4. System applications

[Compass zero field demonstration]

[Compass zero field procedure]

[Compass zero field demonstration]:https://www.youtube.com/watch?v=eRR1c4607lU

[Compass zero field procedure]:https://www.youtube.com/watch?v=aR3ZOZWw4vM&t=

[Coil Features]:CoilFeatures.md

[magpylib]:https://github.com/magpylib/magpylib

[Helmholtz coil]:https://en.wikipedia.org/wiki/Helmholtz_coil

[magnetic field]:https://en.wikipedia.org/wiki/Magnetic_field

[earth magnetic field]:https://en.wikipedia.org/wiki/Earth%27s_magnetic_field

[1.00000037]:https://en.wikipedia.org/wiki/Permeability_(electromagnetism)

[saturate]:https://en.wikipedia.org/wiki/Saturation_(magnetic)

[coil img 1]:https://i.imgur.com/AkZzpYJ.jpg

[hot glue]:https://en.wikipedia.org/wiki/Hot-melt_adhesive

[Missing Image]:https://i.imgur.com/0EmAI26.png

[wire]:https://at.rs-online.com/web/p/kupferdrahte/0357750/


[Missing Image]:(https://i.imgur.com/0EmAI26.png)

[tiny Missing Image]:(https://i.imgur.com/zDgtWUj.png)
